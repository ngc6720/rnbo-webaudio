var q=Object.defineProperty;var K=(i,s,t)=>s in i?q(i,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[s]=t;var Y=(i,s,t)=>(K(i,typeof s!="symbol"?s+"":s,t),t),D=(i,s,t)=>{if(!s.has(i))throw TypeError("Cannot "+t)};var a=(i,s,t)=>(D(i,s,"read from private field"),t?t.call(i):s.get(i)),l=(i,s,t)=>{if(s.has(i))throw TypeError("Cannot add the same private member more than once");s instanceof WeakSet?s.add(i):s.set(i,t)},E=(i,s,t,e)=>(D(i,s,"write to private field"),e?e.call(i,t):s.set(i,t),t);var p=(i,s,t)=>(D(i,s,"access private method"),t);(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))e(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&e(c)}).observe(document,{childList:!0,subtree:!0});function t(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function e(n){if(n.ep)return;n.ep=!0;const r=t(n);fetch(n.href,r)}})();var w,b,L,B,j;class J extends HTMLElement{constructor(){super();l(this,B);l(this,w,[]);l(this,b,document.createElement("div"));l(this,L,(t,[e,n])=>Math.max(e,Math.min(n,t)));Y(this,"input",document.createElement("input"));Y(this,"label",document.createElement("label"));const t=this.attachShadow({mode:"open"});a(this,b).setAttribute("class","slider"),this.input.setAttribute("type","range");const e=document.createElement("style");e.textContent="@import 'components/slider/slider.css'",t.appendChild(e),t.appendChild(a(this,b)),a(this,b).appendChild(this.input),a(this,b).appendChild(this.label)}static get observedAttributes(){return["disabled"]}connectedCallback(){this.setAttribute("disabled",!0)}addListener(t,e,n){t.addEventListener(e,n),a(this,w).push([t,e,n])}disconnectedCallback(){p(this,B,j).call(this)}attributeChangedCallback(t,e,n){t==="disabled"&&(n==="true"?(a(this,b).classList.add("disabled"),this.input.setAttribute("disabled",!0)):(a(this,b).classList.remove("disabled"),this.input.removeAttribute("disabled")))}attach({id:t,name:e,range:n=[0,1],step:r=.001,initialValue:c=n[0],cb:o}={}){t&&this.input.setAttribute("id",t),t&&this.setAttribute("id",t),this.input.setAttribute("min",n[0]),this.input.setAttribute("max",n[1]),e&&this.input.setAttribute("name",e),e&&(this.label.textContent=e),this.input.setAttribute("step",r),this.input.value=c,o&&(o(device,inputId,value),this.addListener(this.input,"change",y=>o(a(this,L).call(this,+y.target.value),n))),this.setAttribute("disabled",!1)}attachParam({param:t,name:e,range:n,step:r=.001,cb:c}={}){this.attach({id:t.id,name:e,range:n??[t.min,t.max],step:r,initialValue:t.value}),this.addListener(this.input,"change",o=>c(t,a(this,L).call(this,+o.target.value,[t.min,t.max])))}attachInlet({inputId:t,name:e,range:n=[0,1],initialValue:r=n[0],step:c=.01,cb:o}={}){this.attach({id:t,name:e,range:n,step:c,initialValue:r}),o(t,this.input.value),this.addListener(this.input,"change",y=>o(t,a(this,L).call(this,+y.target.value,n)))}detach(){p(this,B,j).call(this),this.setAttribute("id",""),this.input.setAttribute("id",""),this.input.setAttribute("min",0),this.input.setAttribute("max",1),this.input.setAttribute("name",""),this.label.textContent="",this.input.setAttribute("step",.001),this.input.value=.5,this.setAttribute("disabled",!0)}setValueNotifying(t){const[e,n]=[+this.input.min,+this.input.max];this.input.value=t*(n-e)+e,this.input.dispatchEvent(new Event("change"))}}w=new WeakMap,b=new WeakMap,L=new WeakMap,B=new WeakSet,j=function(){a(this,w).forEach(t=>t[0].removeEventListener(t[1],t[2],!1)),E(this,w,[])};customElements.define("my-slider",J);var P,g,M,G,A,O;class Q{constructor(s,t=s){l(this,M);l(this,A);l(this,P,void 0);l(this,g,void 0);E(this,P,s),this.down=e=>{},this.drag=e=>{},this.up=e=>{},t.ontouchstart=e=>(p(this,M,G).call(this,e),e.preventDefault()),t.onmousedown=e=>(p(this,M,G).call(this,e),e.preventDefault())}}P=new WeakMap,g=new WeakMap,M=new WeakSet,G=function(s){let t,e;s.type==="touchstart"&&(t="touchmove",e="touchend"),s.type==="mousedown"&&(t="mousemove",e="mouseup");const n=o=>{this.down(p(this,A,O).call(this,o))},r=o=>{this.drag(p(this,A,O).call(this,o))},c=o=>{this.up(p(this,A,O).call(this,o)),document.removeEventListener(t,r),document.removeEventListener(e,c)};n(s),document.addEventListener(t,r),document.addEventListener(e,c)},A=new WeakSet,O=function(s){let t,e,n,r,c,o,y,F,R,N;return t=s.type,e=a(this,P).getBoundingClientRect(),n=e.right-e.left,r=e.bottom-e.top,R=s.movementX??0,N=s.movementY??0,(t==="touchstart"||t==="touchmove")&&(c=s.touches[0].clientX-e.left,o=s.touches[0].clientY-e.top),t==="touchmove"&&(a(this,g)&&(R=c-a(this,g)[0],N=o-a(this,g)[1]),E(this,g,[c,o])),t==="touchend"&&(c=s.changedTouches[0].clientX-e.left,o=s.changedTouches[0].clientY-e.top),(t==="mousedown"||t==="mousemove"||t==="mouseup")&&(c=s.clientX-e.left,o=s.clientY-e.top),(t==="touchend"||t==="mouseup")&&(R=0,N=0,E(this,g,null)),c>n&&(c=n),c<0&&(c=0),o>r&&(o=r),o<0&&(o=0),y=c/n,F=o/r,{width:n,height:r,x:c,y:o,normX:y,normY:F,mX:R,mY:N}};var m,u,v,X,x,I,H,C,V;class W extends HTMLElement{constructor(){super();l(this,I);l(this,C);l(this,m,{x:[],y:[],down:[],up:[],mov:[]});l(this,u,document.createElement("div"));l(this,v,document.createElement("div"));l(this,X,document.createElement("div"));l(this,x,new Q(a(this,v),a(this,u)));const t=this.attachShadow({mode:"open"});a(this,u).setAttribute("class","pad"),a(this,v).setAttribute("class","plane"),a(this,X).setAttribute("class","handle");const e=document.createElement("style");e.textContent="@import 'components/pad/pad.css'",t.appendChild(e),a(this,v).appendChild(a(this,X)),a(this,u).appendChild(a(this,v)),t.appendChild(a(this,u))}static get observedAttributes(){return["disabled"]}connectedCallback(){this.setAttribute("disabled",!0),a(this,x).down=t=>{a(this,m).x.forEach(e=>e.cb(t.normX)),a(this,m).y.forEach(e=>e.cb(1-t.normY)),a(this,m).mov.forEach(e=>e.cb(Math.min(1,Math.max(0,(Math.abs(t.mX)+Math.abs(t.mX))*.5*.01)))),a(this,m).down.forEach(e=>e.cb()),a(this,u).classList.add("active"),p(this,C,V).call(this,t.normX,t.normY)},a(this,x).drag=t=>{a(this,m).mov.forEach(e=>e.cb(Math.min(1,Math.max(0,(Math.abs(t.mX)+Math.abs(t.mX))*.5*.01)))),a(this,m).x.forEach(e=>e.cb(t.normX)),a(this,m).y.forEach(e=>e.cb(1-t.normY)),p(this,C,V).call(this,t.normX,t.normY)},a(this,x).up=t=>{a(this,m).mov.forEach(e=>e.cb(Math.min(1,Math.max(0,(Math.abs(t.mX)+Math.abs(t.mX))*.5*.01)))),a(this,m).up.forEach(e=>e.cb()),a(this,u).classList.remove("active")}}disconnectedCallback(){p(this,I,H).call(this)}attributeChangedCallback(t,e,n){t==="disabled"&&(n==="true"?a(this,u).classList.add("disabled"):a(this,u).classList.remove("disabled"))}register(t,e){a(this,m)[t].push({type:t,cb:e}),this.getAttribute("disabled")==="true"&&this.setAttribute("disabled",!1)}deregisterAll(){p(this,I,H).call(this),this.setAttribute("disabled",!0),p(this,C,V).call(this,.5,.5)}}m=new WeakMap,u=new WeakMap,v=new WeakMap,X=new WeakMap,x=new WeakMap,I=new WeakSet,H=function(){E(this,m,{x:[],y:[],down:[],up:[],mov:[]})},C=new WeakSet,V=function(t,e){a(this,u).style.setProperty("--posX",t),a(this,u).style.setProperty("--posY",e),a(this,u).style.setProperty("--rotationY",`${(t-.5)*-24}deg`),a(this,u).style.setProperty("--rotationX",`${(e-.5)*24}deg`)};customElements.define("my-pad",W);let U,f=null,d;const _=document.createElement("my-slider"),$=document.createElement("my-slider"),k=document.createElement("my-slider"),z=document.createElement("my-slider"),h=document.createElement("my-pad");function Z(i){return new Promise((s,t)=>{if(/^\d+\.\d+\.\d+-dev$/.test(i))throw new Error(`Patcher exported with a Debug Version!
Please specify the correct RNBO version to use in the code.`);const e=document.createElement("script");e.src="https://c74-public.nyc3.digitaloceanspaces.com/rnbo/"+encodeURIComponent(i)+"/rnbo.min.js",e.onload=s,e.onerror=function(n){console.log(n),t(new Error("Failed to load rnbo.js v"+i))},document.body.append(e)})}async function tt(){let i,s;if(!f)try{f=new AudioContext({sampleRate:44100})}catch(t){return console.error("createProcessorNodes() -> Unable to create audio context"),console.error(t),null}try{s=f.createGain(),i=await RNBO.createDevice({context:f,patcher:U})}catch(t){console.error("createProcessorNodes() -> Unable to create device"),console.error(t)}return await f.resume(),{device:i,gain:s}}async function et(i,s,t){const n=await(await fetch(t)).arrayBuffer(),r=await f.decodeAudioData(n);await i.setDataBuffer(s,r)}function S(i=null){return i?(s="in1",t=1)=>{const e=new RNBO.MessageEvent(RNBO.TimeNow,s,[t]);i==null||i.scheduleEvent(e)}:()=>{}}function T(i,s){i&&(i.value=s)}async function st(){if(d=await tt(),!d){console.error("audioStart() -> unable to create processor nodes");return}et(d.device,"src","./media/gris.mp3"),$.attachInlet({inputId:"in2",name:"Position",range:[0,1],initialValue:.16,step:.001,cb:S(d.device)}),_.attachParam({param:d.device.parametersById.get("grains/density_hz"),name:"Density",cb:T}),k.attachParam({param:d.device.parametersById.get("grains/grain_ms"),name:"Grain Duration",range:[150,2e3],cb:T}),z.attachParam({param:d.device.parametersById.get("grains/spread_ms"),name:"Spread",range:[250,8e3],cb:T}),h.register("down",()=>S(d==null?void 0:d.device)("in1",1)),h.register("up",()=>S(d==null?void 0:d.device)("in1",0)),h.register("x",i=>$.setValueNotifying(i)),h.register("y",i=>_.setValueNotifying(i)),h.register("mov",i=>k.setValueNotifying(i)),h.register("mov",i=>z.setValueNotifying(i)),d.device.node.connect(d.gain).connect(f.destination)}async function it(){var i,s,t,e;h.deregisterAll();for(let n of(i=d==null?void 0:d.device)==null?void 0:i.parameters)(s=document.getElementById(n.id))==null||s.detach();for(let n of(t=d==null?void 0:d.device)==null?void 0:t.inports)(e=document.getElementById(n.tag))==null||e.detach();d={},await f.close(),f=null}async function nt(i){f?(it(),document.getElementById("toggle").classList.add("hint"),h.classList.remove("hint")):(st(),h.classList.add("hint"))}[_,$,k,z].forEach(i=>document.getElementById("sliders").appendChild(i));document.getElementById("sliders").style.display="none";document.getElementById("ui").appendChild(h);(async()=>{h.classList.add("loading1"),U=await(await fetch("./patch/patch.export.json")).json(),h.classList.remove("loading1"),window.RNBO||(h.classList.add("loading2"),await Z(U.desc.meta.rnboversion),h.classList.remove("loading2")),document.getElementById("toggle").classList.add("hint");function s(t){t.target.removeEventListener("mousedown",s,!1),t.target.classList.remove("hint")}document.getElementById("toggle").addEventListener("click",s),h.addEventListener("mousedown",t=>t.target.classList.remove("hint")),document.getElementById("toggle").addEventListener("click",nt)})();
