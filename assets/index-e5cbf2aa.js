var q=Object.defineProperty;var K=(r,o,e)=>o in r?q(r,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[o]=e;var Y=(r,o,e)=>(K(r,typeof o!="symbol"?o+"":o,e),e),R=(r,o,e)=>{if(!o.has(r))throw TypeError("Cannot "+e)};var n=(r,o,e)=>(R(r,o,"read from private field"),e?e.call(r):o.get(r)),d=(r,o,e)=>{if(o.has(r))throw TypeError("Cannot add the same private member more than once");o instanceof WeakSet?o.add(r):o.set(r,e)},x=(r,o,e,t)=>(R(r,o,"write to private field"),t?t.call(r,e):o.set(r,e),e);var m=(r,o,e)=>(R(r,o,"access private method"),e);(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))t(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&t(l)}).observe(document,{childList:!0,subtree:!0});function e(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function t(i){if(i.ep)return;i.ep=!0;const a=e(i);fetch(i.href,a)}})();const J=`:root{font-family:Inter,system-ui,Avenir,Helvetica,Arial,sans-serif;font-size:16px;line-height:1.5;font-weight:400;color-scheme:light dark;font-synthesis:none;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-text-size-adjust:100%;--color-background: white;--color-surface: #f9f9f9;--color-text: rgb(66, 66, 66);--color-disabled: rgb(161, 161, 161);--color-accent: #646cff;--color-outline: orange;--color-hint: rgb(44, 148, 101)}body{margin:0;align-items:center;justify-content:center;gap:1rem;color:var(--color-text);background-color:var(--color-background);font-weight:500}*{box-sizing:border-box}button{box-sizing:border-box;border-radius:8px;border:1px solid transparent;padding:.6em 1.2em;font-size:1rem;font-weight:500;font-family:inherit;background-color:var(--color-surface);cursor:pointer;transition:border-color .25s;color:var(--color-text)}button:active{outline:1px auto var(--color-outline)}a{width:fit-content}#ui,#info{position:relative;margin:auto;margin-top:2rem;display:flex;flex-direction:column;gap:2rem;width:clamp(0rem,28rem,100%);padding:2rem}#loading{position:absolute;top:0}#buttons{display:flex;gap:1rem}#sliders{display:flex;flex-direction:column;gap:4rem;min-width:100%;margin-bottom:2rem;pointer-events:none}.hint{position:relative}.hint:after{color:var(--color-hint);font-size:1rem;font-weight:500;position:absolute;height:1.6rem;border-radius:8px;pointer-events:none;text-align:center;text-justify:center;top:-3rem;left:0}.hint:before{content:"";font-size:1rem;position:absolute;border-left:.4rem solid transparent;border-right:.4rem solid transparent;border-top:.4rem solid var(--color-hint);border-bottom:.4rem solid transparent;pointer-events:none;border-radius:2px;z-index:2;top:-1.4rem;left:calc(50% - .4rem)}button.hint:after{content:"start audio";width:11ch;left:calc(50% - 5.5ch)}my-pad.hint:after{content:"play !";width:6ch;left:calc(50% - 3ch)}my-pad.loading1:after{content:"Adding patcher...";position:absolute;font-size:.8rem}my-pad.loading2:after{content:"Loading RNBO...";position:absolute;font-size:.8rem}#switchDescription{display:none}#switchDescription+label{box-sizing:border-box;border-radius:8px;border:1px solid transparent;padding:.6em 1.2em;font-size:1rem;font-weight:500;font-family:inherit;background-color:var(--color-surface);transition:border-color .25s;color:var(--color-text);width:2rem;height:2rem;display:flex;align-items:center;justify-content:center;cursor:pointer;-webkit-user-select:none;user-select:none}#switchDescription+label:active{outline:1px auto var(--color-outline)}#description{display:none}#switchDescription:checked~#description{display:block}@media (prefers-color-scheme: dark){:root{--color-background: #242424;--color-surface: rgb(56, 56, 56);--color-text: rgba(255, 255, 255, .87);--color-disabled: rgb(161, 161, 161);--color-accent: #bbbeff;--color-hint: rgb(100, 255, 185)}}@media (hover){a:hover{color:var(--color-accent)}button:hover,#switchDescription+label:hover{border-color:var(--color-accent)}}.slider{--color-slider: var(--color-surface);--color-label: var(--color-text);--color-handle: var(--color-text);--color-line: var(--color-text);--color-handle-disabled: var(--color-disabled);--color-line-disabled: var(--color-disabled);font-size:.8rem;color:var(--color-label);font-weight:500;display:flex;position:relative}.slider.disabled{--color-line: var(--color-line-disabled);--color-handle: var(--color-handle-disabled)}input[type=range]{width:100%;-webkit-appearance:none;-webkit-tap-highlight-color:transparent;outline:none;height:0;margin:0;border-radius:8px;background-color:var(--color-surface);border:1px solid transparent;background:var(--color-slider);transition:border-color .25s;cursor:pointer}input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;background:var(--color-surface);width:.75rem;height:1rem;border-radius:4px;border:3px solid var(--color-handle);pointer-events:all}input[type=range]::-moz-range-thumb{width:.75rem;height:1rem;border-radius:4px;border:none;pointer-events:all}input[type=range]~label{color:var(--color-label);font-weight:500;position:absolute;top:-1.2rem;left:0}input[type=range]:not([disabled]):active{outline:1px auto var(--color-outline)}@media (hover){input[type=range]:not([disabled]):hover{border-color:var(--color-accent)}input[type=range]:disabled:hover{cursor:default}}
`;var w,f,E,k,j;class Q extends HTMLElement{constructor(){super();d(this,k);d(this,w,[]);d(this,f,document.createElement("div"));d(this,E,(e,[t,i])=>Math.max(t,Math.min(i,e)));Y(this,"input",document.createElement("input"));Y(this,"label",document.createElement("label"));const e=this.attachShadow({mode:"open"});n(this,f).setAttribute("class","slider"),this.input.setAttribute("type","range");const t=document.createElement("style");t.textContent=J,e.appendChild(t),e.appendChild(n(this,f)),n(this,f).appendChild(this.input),n(this,f).appendChild(this.label)}static get observedAttributes(){return["disabled"]}connectedCallback(){this.setAttribute("disabled",!0)}addListener(e,t,i){e.addEventListener(t,i),n(this,w).push([e,t,i])}disconnectedCallback(){m(this,k,j).call(this)}attributeChangedCallback(e,t,i){e==="disabled"&&(i==="true"?(n(this,f).classList.add("disabled"),this.input.setAttribute("disabled",!0)):(n(this,f).classList.remove("disabled"),this.input.removeAttribute("disabled")))}attach({id:e,name:t,range:i=[0,1],step:a=.001,initialValue:l=i[0],cb:s}={}){e&&this.input.setAttribute("id",e),e&&this.setAttribute("id",e),this.input.setAttribute("min",i[0]),this.input.setAttribute("max",i[1]),t&&this.input.setAttribute("name",t),t&&(this.label.textContent=t),this.input.setAttribute("step",a),this.input.value=l,s&&(s(device,inputId,value),this.addListener(this.input,"change",y=>s(n(this,E).call(this,+y.target.value),i))),this.setAttribute("disabled",!1)}attachParam({param:e,name:t,range:i,step:a=.001,cb:l}={}){this.attach({id:e.id,name:t,range:i??[e.min,e.max],step:a,initialValue:e.value}),this.addListener(this.input,"change",s=>l(e,n(this,E).call(this,+s.target.value,[e.min,e.max])))}attachInlet({inputId:e,name:t,range:i=[0,1],initialValue:a=i[0],step:l=.01,cb:s}={}){this.attach({id:e,name:t,range:i,step:l,initialValue:a}),s(e,this.input.value),this.addListener(this.input,"change",y=>s(e,n(this,E).call(this,+y.target.value,i)))}detach(){m(this,k,j).call(this),this.setAttribute("id",""),this.input.setAttribute("id",""),this.input.setAttribute("min",0),this.input.setAttribute("max",1),this.input.setAttribute("name",""),this.label.textContent="",this.input.setAttribute("step",.001),this.input.value=.5,this.setAttribute("disabled",!0)}setValueNotifying(e){const[t,i]=[+this.input.min,+this.input.max];this.input.value=e*(i-t)+t,this.input.dispatchEvent(new Event("change"))}}w=new WeakMap,f=new WeakMap,E=new WeakMap,k=new WeakSet,j=function(){n(this,w).forEach(e=>e[0].removeEventListener(e[1],e[2],!1)),x(this,w,[])};customElements.define("my-slider",Q);var B,g,C,V,L,I;class W{constructor(o,e=o){d(this,C);d(this,L);d(this,B,void 0);d(this,g,void 0);x(this,B,o),this.down=t=>{},this.drag=t=>{},this.up=t=>{},e.ontouchstart=t=>(m(this,C,V).call(this,t),t.preventDefault()),e.onmousedown=t=>(m(this,C,V).call(this,t),t.preventDefault())}}B=new WeakMap,g=new WeakMap,C=new WeakSet,V=function(o){let e,t;o.type==="touchstart"&&(e="touchmove",t="touchend"),o.type==="mousedown"&&(e="mousemove",t="mouseup");const i=s=>{this.down(m(this,L,I).call(this,s))},a=s=>{this.drag(m(this,L,I).call(this,s))},l=s=>{this.up(m(this,L,I).call(this,s)),document.removeEventListener(e,a),document.removeEventListener(t,l)};i(o),document.addEventListener(e,a),document.addEventListener(t,l)},L=new WeakSet,I=function(o){let e,t,i,a,l,s,y,F,D,M;return e=o.type,t=n(this,B).getBoundingClientRect(),i=t.right-t.left,a=t.bottom-t.top,D=o.movementX??0,M=o.movementY??0,(e==="touchstart"||e==="touchmove")&&(l=o.touches[0].clientX-t.left,s=o.touches[0].clientY-t.top),e==="touchmove"&&(n(this,g)&&(D=l-n(this,g)[0],M=s-n(this,g)[1]),x(this,g,[l,s])),e==="touchend"&&(l=o.changedTouches[0].clientX-t.left,s=o.changedTouches[0].clientY-t.top),(e==="mousedown"||e==="mousemove"||e==="mouseup")&&(l=o.clientX-t.left,s=o.clientY-t.top),(e==="touchend"||e==="mouseup")&&(D=0,M=0,x(this,g,null)),l>i&&(l=i),l<0&&(l=0),s>a&&(s=a),s<0&&(s=0),y=l/i,F=s/a,{width:i,height:a,x:l,y:s,normX:y,normY:F,mX:D,mY:M}};const Z=`:root{font-family:Inter,system-ui,Avenir,Helvetica,Arial,sans-serif;font-size:16px;line-height:1.5;font-weight:400;color-scheme:light dark;font-synthesis:none;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-text-size-adjust:100%;--color-background: white;--color-surface: #f9f9f9;--color-text: rgb(66, 66, 66);--color-disabled: rgb(161, 161, 161);--color-accent: #646cff;--color-outline: orange;--color-hint: rgb(44, 148, 101)}body{margin:0;align-items:center;justify-content:center;gap:1rem;color:var(--color-text);background-color:var(--color-background);font-weight:500}*{box-sizing:border-box}button{box-sizing:border-box;border-radius:8px;border:1px solid transparent;padding:.6em 1.2em;font-size:1rem;font-weight:500;font-family:inherit;background-color:var(--color-surface);cursor:pointer;transition:border-color .25s;color:var(--color-text)}button:active{outline:1px auto var(--color-outline)}a{width:fit-content}#ui,#info{position:relative;margin:auto;margin-top:2rem;display:flex;flex-direction:column;gap:2rem;width:clamp(0rem,28rem,100%);padding:2rem}#loading{position:absolute;top:0}#buttons{display:flex;gap:1rem}#sliders{display:flex;flex-direction:column;gap:4rem;min-width:100%;margin-bottom:2rem;pointer-events:none}.hint{position:relative}.hint:after{color:var(--color-hint);font-size:1rem;font-weight:500;position:absolute;height:1.6rem;border-radius:8px;pointer-events:none;text-align:center;text-justify:center;top:-3rem;left:0}.hint:before{content:"";font-size:1rem;position:absolute;border-left:.4rem solid transparent;border-right:.4rem solid transparent;border-top:.4rem solid var(--color-hint);border-bottom:.4rem solid transparent;pointer-events:none;border-radius:2px;z-index:2;top:-1.4rem;left:calc(50% - .4rem)}button.hint:after{content:"start audio";width:11ch;left:calc(50% - 5.5ch)}my-pad.hint:after{content:"play !";width:6ch;left:calc(50% - 3ch)}my-pad.loading1:after{content:"Adding patcher...";position:absolute;font-size:.8rem}my-pad.loading2:after{content:"Loading RNBO...";position:absolute;font-size:.8rem}#switchDescription{display:none}#switchDescription+label{box-sizing:border-box;border-radius:8px;border:1px solid transparent;padding:.6em 1.2em;font-size:1rem;font-weight:500;font-family:inherit;background-color:var(--color-surface);transition:border-color .25s;color:var(--color-text);width:2rem;height:2rem;display:flex;align-items:center;justify-content:center;cursor:pointer;-webkit-user-select:none;user-select:none}#switchDescription+label:active{outline:1px auto var(--color-outline)}#description{display:none}#switchDescription:checked~#description{display:block}@media (prefers-color-scheme: dark){:root{--color-background: #242424;--color-surface: rgb(56, 56, 56);--color-text: rgba(255, 255, 255, .87);--color-disabled: rgb(161, 161, 161);--color-accent: #bbbeff;--color-hint: rgb(100, 255, 185)}}@media (hover){a:hover{color:var(--color-accent)}button:hover,#switchDescription+label:hover{border-color:var(--color-accent)}}.pad{--color-pad: var(--color-surface);--color-handle: var(--color-text);--color-handle-disabled: var(--color-disabled);--handleSize: 3rem;--posX: .5;--posY: .5;--rotationY: 0;--rotationX: 0;display:flex;position:relative;border-radius:8px;padding:calc(var(--handleSize)/2) calc(var(--handleSize)/2);cursor:pointer;background-color:var(--color-pad);border:1px solid transparent}.pad.disabled{--color-handle: var(--color-handle-disabled);pointer-events:none}.plane{position:relative;width:100%;padding-bottom:100%}.handle{position:absolute;width:var(--handleSize);height:var(--handleSize);border-radius:50%;border:3px solid var(--color-handle);left:calc(var(--posX) * 100% - var(--handleSize)/2);top:calc(var(--posY) * 100% - var(--handleSize)/2)}.pad.active .handle{background-color:var(--color-handle);cursor:none}.pad.active{transform:perspective(90rem) rotateY(var(--rotationY)) rotateX(var(--rotationX));border:1px solid var(--color-handle)}
`;var p,h,v,P,A,X,T,z,S;class ee extends HTMLElement{constructor(){super();d(this,X);d(this,z);d(this,p,{x:[],y:[],down:[],up:[],mov:[]});d(this,h,document.createElement("div"));d(this,v,document.createElement("div"));d(this,P,document.createElement("div"));d(this,A,new W(n(this,v),n(this,h)));const e=this.attachShadow({mode:"open"});n(this,h).setAttribute("class","pad"),n(this,v).setAttribute("class","plane"),n(this,P).setAttribute("class","handle");const t=document.createElement("style");t.textContent=Z,e.appendChild(t),n(this,v).appendChild(n(this,P)),n(this,h).appendChild(n(this,v)),e.appendChild(n(this,h))}static get observedAttributes(){return["disabled"]}connectedCallback(){this.setAttribute("disabled",!0),n(this,A).down=e=>{n(this,p).x.forEach(t=>t.cb(e.normX)),n(this,p).y.forEach(t=>t.cb(1-e.normY)),n(this,p).mov.forEach(t=>t.cb(Math.min(1,Math.max(0,(Math.abs(e.mX)+Math.abs(e.mX))*.5*.01)))),n(this,p).down.forEach(t=>t.cb()),n(this,h).classList.add("active"),m(this,z,S).call(this,e.normX,e.normY)},n(this,A).drag=e=>{n(this,p).mov.forEach(t=>t.cb(Math.min(1,Math.max(0,(Math.abs(e.mX)+Math.abs(e.mX))*.5*.01)))),n(this,p).x.forEach(t=>t.cb(e.normX)),n(this,p).y.forEach(t=>t.cb(1-e.normY)),m(this,z,S).call(this,e.normX,e.normY)},n(this,A).up=e=>{n(this,p).mov.forEach(t=>t.cb(Math.min(1,Math.max(0,(Math.abs(e.mX)+Math.abs(e.mX))*.5*.01)))),n(this,p).up.forEach(t=>t.cb()),n(this,h).classList.remove("active")}}disconnectedCallback(){m(this,X,T).call(this)}attributeChangedCallback(e,t,i){e==="disabled"&&(i==="true"?n(this,h).classList.add("disabled"):n(this,h).classList.remove("disabled"))}register(e,t){n(this,p)[e].push({type:e,cb:t}),this.getAttribute("disabled")==="true"&&this.setAttribute("disabled",!1)}deregisterAll(){m(this,X,T).call(this),this.setAttribute("disabled",!0),m(this,z,S).call(this,.5,.5)}}p=new WeakMap,h=new WeakMap,v=new WeakMap,P=new WeakMap,A=new WeakMap,X=new WeakSet,T=function(){x(this,p,{x:[],y:[],down:[],up:[],mov:[]})},z=new WeakSet,S=function(e,t){n(this,h).style.setProperty("--posX",e),n(this,h).style.setProperty("--posY",t),n(this,h).style.setProperty("--rotationY",`${(e-.5)*-24}deg`),n(this,h).style.setProperty("--rotationX",`${(t-.5)*24}deg`)};customElements.define("my-pad",ee);let H,b=null,c;const $=document.createElement("my-slider"),G=document.createElement("my-slider"),U=document.createElement("my-slider"),_=document.createElement("my-slider"),u=document.createElement("my-pad");function te(r){return new Promise((o,e)=>{if(/^\d+\.\d+\.\d+-dev$/.test(r))throw new Error(`Patcher exported with a Debug Version!
Please specify the correct RNBO version to use in the code.`);const t=document.createElement("script");t.src="https://c74-public.nyc3.digitaloceanspaces.com/rnbo/"+encodeURIComponent(r)+"/rnbo.min.js",t.onload=o,t.onerror=function(i){console.log(i),e(new Error("Failed to load rnbo.js v"+r))},document.body.append(t)})}async function oe(){let r,o;if(!b)try{b=new AudioContext({sampleRate:44100})}catch(e){return console.error("createProcessorNodes() -> Unable to create audio context"),console.error(e),null}try{o=b.createGain(),r=await RNBO.createDevice({context:b,patcher:H})}catch(e){console.error("createProcessorNodes() -> Unable to create device"),console.error(e)}return await b.resume(),{device:r,gain:o}}async function re(r,o,e){const i=await(await fetch(e)).arrayBuffer(),a=await b.decodeAudioData(i);await r.setDataBuffer(o,a)}function N(r=null){return r?(o="in1",e=1)=>{const t=new RNBO.MessageEvent(RNBO.TimeNow,o,[e]);r==null||r.scheduleEvent(t)}:()=>{}}function O(r,o){r&&(r.value=o)}async function ie(){if(c=await oe(),!c){console.error("audioStart() -> unable to create processor nodes");return}re(c.device,"src","/media/gris.mp3"),G.attachInlet({inputId:"in2",name:"Position",range:[0,1],initialValue:.16,step:.001,cb:N(c.device)}),$.attachParam({param:c.device.parametersById.get("grains/density_hz"),name:"Density",cb:O}),U.attachParam({param:c.device.parametersById.get("grains/grain_ms"),name:"Grain Duration",range:[150,2e3],cb:O}),_.attachParam({param:c.device.parametersById.get("grains/spread_ms"),name:"Spread",range:[250,8e3],cb:O}),u.register("down",()=>N(c==null?void 0:c.device)("in1",1)),u.register("up",()=>N(c==null?void 0:c.device)("in1",0)),u.register("x",r=>G.setValueNotifying(r)),u.register("y",r=>$.setValueNotifying(r)),u.register("mov",r=>U.setValueNotifying(r)),u.register("mov",r=>_.setValueNotifying(r)),c.device.node.connect(c.gain).connect(b.destination)}async function ne(){var r,o,e,t;u.deregisterAll();for(let i of(r=c==null?void 0:c.device)==null?void 0:r.parameters)(o=document.getElementById(i.id))==null||o.detach();for(let i of(e=c==null?void 0:c.device)==null?void 0:e.inports)(t=document.getElementById(i.tag))==null||t.detach();c={},await b.close(),b=null}async function ae(r){b?(ne(),document.getElementById("toggle").classList.add("hint"),u.classList.remove("hint")):(ie(),u.classList.add("hint"))}[$,G,U,_].forEach(r=>document.getElementById("sliders").appendChild(r));document.getElementById("sliders").style.display="none";document.getElementById("ui").appendChild(u);(async()=>{u.classList.add("loading1"),H=await(await fetch("/patch/patch.export.json")).json(),u.classList.remove("loading1"),window.RNBO||(u.classList.add("loading2"),await te(H.desc.meta.rnboversion),u.classList.remove("loading2")),document.getElementById("toggle").classList.add("hint");function o(e){e.target.removeEventListener("mousedown",o,!1),e.target.classList.remove("hint")}document.getElementById("toggle").addEventListener("click",o),u.addEventListener("mousedown",e=>e.target.classList.remove("hint")),document.getElementById("toggle").addEventListener("click",ae)})();
