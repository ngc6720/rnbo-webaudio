var F=Object.defineProperty;var q=(i,s,t)=>s in i?F(i,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[s]=t;var O=(i,s,t)=>(q(i,typeof s!="symbol"?s+"":s,t),t),M=(i,s,t)=>{if(!s.has(i))throw TypeError("Cannot "+t)};var a=(i,s,t)=>(M(i,s,"read from private field"),t?t.call(i):s.get(i)),l=(i,s,t)=>{if(s.has(i))throw TypeError("Cannot add the same private member more than once");s instanceof WeakSet?s.add(i):s.set(i,t)},R=(i,s,t,e)=>(M(i,s,"write to private field"),e?e.call(i,t):s.set(i,t),t);var m=(i,s,t)=>(M(i,s,"access private method"),t);(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))e(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&e(c)}).observe(document,{childList:!0,subtree:!0});function t(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function e(n){if(n.ep)return;n.ep=!0;const r=t(n);fetch(n.href,r)}})();var y,g,E,x,D;class K extends HTMLElement{constructor(){super();l(this,x);l(this,y,[]);l(this,g,document.createElement("div"));l(this,E,(t,[e,n])=>Math.max(e,Math.min(n,t)));O(this,"input",document.createElement("input"));O(this,"label",document.createElement("label"));const t=this.attachShadow({mode:"open"});a(this,g).setAttribute("class","slider"),this.input.setAttribute("type","range");const e=document.createElement("style");e.textContent="@import 'components/slider/slider.css'",t.appendChild(e),t.appendChild(a(this,g)),a(this,g).appendChild(this.input),a(this,g).appendChild(this.label)}static get observedAttributes(){return["disabled"]}connectedCallback(){this.setAttribute("disabled",!0)}addListener(t,e,n){t.addEventListener(e,n),a(this,y).push([t,e,n])}disconnectedCallback(){m(this,x,D).call(this)}attributeChangedCallback(t,e,n){t==="disabled"&&(n==="true"?(a(this,g).classList.add("disabled"),this.input.setAttribute("disabled",!0)):(a(this,g).classList.remove("disabled"),this.input.removeAttribute("disabled")))}attach({id:t,name:e,range:n=[0,1],step:r=.001,initialValue:c=n[0],cb:o}={}){t&&this.input.setAttribute("id",t),t&&this.setAttribute("id",t),this.input.setAttribute("min",n[0]),this.input.setAttribute("max",n[1]),e&&this.input.setAttribute("name",e),e&&(this.label.textContent=e),this.input.setAttribute("step",r),this.input.value=c,o&&(o(device,inputId,value),this.addListener(this.input,"change",v=>o(a(this,E).call(this,+v.target.value),n))),this.setAttribute("disabled",!1)}attachParam({param:t,name:e,range:n,step:r=.001,cb:c}={}){this.attach({id:t.id,name:e,range:n??[t.min,t.max],step:r,initialValue:t.value}),this.addListener(this.input,"change",o=>c(t,a(this,E).call(this,+o.target.value,[t.min,t.max])))}attachInlet({inputId:t,name:e,range:n=[0,1],initialValue:r=n[0],step:c=.01,cb:o}={}){this.attach({id:t,name:e,range:n,step:c,initialValue:r}),o(t,this.input.value),this.addListener(this.input,"change",v=>o(t,a(this,E).call(this,+v.target.value,n)))}detach(){m(this,x,D).call(this),this.setAttribute("id",""),this.input.setAttribute("id",""),this.input.setAttribute("min",0),this.input.setAttribute("max",1),this.input.setAttribute("name",""),this.label.textContent="",this.input.setAttribute("step",.001),this.input.value=.5,this.setAttribute("disabled",!0)}setValueNotifying(t){const[e,n]=[+this.input.min,+this.input.max];this.input.value=t*(n-e)+e,this.input.dispatchEvent(new Event("change"))}}y=new WeakMap,g=new WeakMap,E=new WeakMap,x=new WeakSet,D=function(){a(this,y).forEach(t=>t[0].removeEventListener(t[1],t[2],!1)),R(this,y,[])};customElements.define("my-slider",K);var C,B,S,w,X;class J{constructor(s,t=s){l(this,B);l(this,w);l(this,C,void 0);R(this,C,s),this.down=e=>{},this.drag=e=>{},this.up=()=>{},t.ontouchstart=e=>(m(this,B,S).call(this,e),e.preventDefault()),t.onmousedown=e=>(m(this,B,S).call(this,e),e.preventDefault())}}C=new WeakMap,B=new WeakSet,S=function(s){let t,e;s.type==="touchstart"&&(t="touchmove",e="touchend"),s.type==="mousedown"&&(t="mousemove",e="mouseup");const n=o=>{this.down(m(this,w,X).call(this,o))},r=o=>{this.drag(m(this,w,X).call(this,o))},c=o=>{this.up(m(this,w,X).call(this,o)),document.removeEventListener(t,r),document.removeEventListener(e,c)};n(s),document.addEventListener(t,r),document.addEventListener(e,c)},w=new WeakSet,X=function(s){let t,e,n,r,c,o,v,$,k,z;return t=s.type,e=a(this,C).getBoundingClientRect(),n=e.right-e.left,r=e.bottom-e.top,k=s.movementX,z=s.movementY,(t==="touchstart"||t==="touchmove")&&(c=s.touches[0].clientX-e.left,o=s.touches[0].clientY-e.top),t==="touchend"&&(c=s.changedTouches[0].clientX-e.left,o=s.changedTouches[0].clientY-e.top),(t==="mousedown"||t==="mousemove"||t==="mouseup")&&(c=s.clientX-e.left,o=s.clientY-e.top),c>n&&(c=n),c<0&&(c=0),o>r&&(o=r),o<0&&(o=0),v=c/n,$=o/r,{width:n,height:r,x:c,y:o,normX:v,normY:$,mX:k,mY:z}};var p,u,b,P,L,I,T,A,N;class Q extends HTMLElement{constructor(){super();l(this,I);l(this,A);l(this,p,{x:[],y:[],down:[],up:[],mov:[]});l(this,u,document.createElement("div"));l(this,b,document.createElement("div"));l(this,P,document.createElement("div"));l(this,L,new J(a(this,b),a(this,u)));const t=this.attachShadow({mode:"open"});a(this,u).setAttribute("class","pad"),a(this,b).setAttribute("class","plane"),a(this,P).setAttribute("class","handle");const e=document.createElement("style");e.textContent="@import 'components/pad/pad.css'",t.appendChild(e),a(this,b).appendChild(a(this,P)),a(this,u).appendChild(a(this,b)),t.appendChild(a(this,u))}static get observedAttributes(){return["disabled"]}connectedCallback(){this.setAttribute("disabled",!0),a(this,L).down=t=>{a(this,p).x.forEach(e=>e.cb(t.normX)),a(this,p).y.forEach(e=>e.cb(1-t.normY)),a(this,p).down.forEach(e=>e.cb()),a(this,u).classList.add("active"),m(this,A,N).call(this,t.normX,t.normY)},a(this,L).drag=t=>{a(this,p).mov.forEach(e=>e.cb(Math.min(1,Math.max(0,(Math.abs(t.mX)+Math.abs(t.mX))*.5*.01)))),a(this,p).x.forEach(e=>e.cb(t.normX)),a(this,p).y.forEach(e=>e.cb(1-t.normY)),m(this,A,N).call(this,t.normX,t.normY)},a(this,L).up=()=>{a(this,p).up.forEach(t=>t.cb()),a(this,u).classList.remove("active")}}disconnectedCallback(){m(this,I,T).call(this)}attributeChangedCallback(t,e,n){t==="disabled"&&(n==="true"?a(this,u).classList.add("disabled"):a(this,u).classList.remove("disabled"))}register(t,e){a(this,p)[t].push({type:t,cb:e}),this.getAttribute("disabled")==="true"&&this.setAttribute("disabled",!1)}deregisterAll(){m(this,I,T).call(this),this.setAttribute("disabled",!0),m(this,A,N).call(this,.5,.5)}}p=new WeakMap,u=new WeakMap,b=new WeakMap,P=new WeakMap,L=new WeakMap,I=new WeakSet,T=function(){R(this,p,{x:[],y:[],down:[],up:[],mov:[]})},A=new WeakSet,N=function(t,e){a(this,u).style.setProperty("--posX",t),a(this,u).style.setProperty("--posY",e),a(this,u).style.setProperty("--rotationY",`${(t-.5)*-24}deg`),a(this,u).style.setProperty("--rotationX",`${(e-.5)*24}deg`)};customElements.define("my-pad",Q);let j,f=null,d;const G=document.createElement("my-slider"),H=document.createElement("my-slider"),U=document.createElement("my-slider"),_=document.createElement("my-slider"),h=document.createElement("my-pad");function W(i){return new Promise((s,t)=>{if(/^\d+\.\d+\.\d+-dev$/.test(i))throw new Error(`Patcher exported with a Debug Version!
Please specify the correct RNBO version to use in the code.`);const e=document.createElement("script");e.src="https://c74-public.nyc3.digitaloceanspaces.com/rnbo/"+encodeURIComponent(i)+"/rnbo.min.js",e.onload=s,e.onerror=function(n){console.log(n),t(new Error("Failed to load rnbo.js v"+i))},document.body.append(e)})}async function Z(){let i,s;if(!f)try{f=new AudioContext({sampleRate:44100})}catch(t){return console.error("createProcessorNodes() -> Unable to create audio context"),console.error(t),null}try{s=f.createGain(),i=await RNBO.createDevice({context:f,patcher:j})}catch(t){console.error("createProcessorNodes() -> Unable to create device"),console.error(t)}return await f.resume(),{device:i,gain:s}}async function tt(i,s,t){const n=await(await fetch(t)).arrayBuffer(),r=await f.decodeAudioData(n);await i.setDataBuffer(s,r)}function V(i=null){return i?(s="in1",t=1)=>{const e=new RNBO.MessageEvent(RNBO.TimeNow,s,[t]);i==null||i.scheduleEvent(e)}:()=>{}}function Y(i,s){i&&(i.value=s)}async function et(){if(d=await Z(),!d){console.error("audioStart() -> unable to create processor nodes");return}tt(d.device,"src","./media/gris.wav"),H.attachInlet({inputId:"in2",name:"Position",range:[0,1],initialValue:.16,step:.001,cb:V(d.device)}),G.attachParam({param:d.device.parametersById.get("grains/density_hz"),name:"Density",cb:Y}),U.attachParam({param:d.device.parametersById.get("grains/grain_ms"),name:"Grain Duration",range:[150,2e3],cb:Y}),_.attachParam({param:d.device.parametersById.get("grains/spread_ms"),name:"Spread",range:[250,8e3],cb:Y}),h.register("down",()=>V(d==null?void 0:d.device)("in1",1)),h.register("up",()=>V(d==null?void 0:d.device)("in1",0)),h.register("x",i=>H.setValueNotifying(i)),h.register("y",i=>G.setValueNotifying(i)),h.register("mov",i=>U.setValueNotifying(i)),h.register("mov",i=>_.setValueNotifying(i)),d.device.node.connect(d.gain).connect(f.destination)}async function st(){var i,s,t,e;h.deregisterAll();for(let n of(i=d==null?void 0:d.device)==null?void 0:i.parameters)(s=document.getElementById(n.id))==null||s.detach();for(let n of(t=d==null?void 0:d.device)==null?void 0:t.inports)(e=document.getElementById(n.tag))==null||e.detach();d={},await f.close(),f=null}async function it(i){f?(st(),document.getElementById("toggle").classList.add("hint"),h.classList.remove("hint")):(et(),h.classList.add("hint"))}[G,H,U,_].forEach(i=>document.getElementById("sliders").appendChild(i));document.getElementById("sliders").style.display="none";document.getElementById("ui").appendChild(h);(async()=>{h.classList.add("loading1"),j=await(await fetch("./patch/patch.export.json")).json(),h.classList.remove("loading1"),h.classList.add("loading2"),window.RNBO||await W(j.desc.meta.rnboversion),h.classList.remove("loading2"),document.getElementById("toggle").classList.add("hint");function s(t){t.target.removeEventListener("mousedown",s,!1),t.target.classList.remove("hint")}document.getElementById("toggle").addEventListener("click",s),h.addEventListener("mousedown",t=>t.target.classList.remove("hint")),document.getElementById("toggle").addEventListener("click",it)})();
